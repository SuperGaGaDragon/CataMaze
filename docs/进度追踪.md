# CataMaze 进度追踪

> 目标：把文档里描述的单机回合制迷宫射击游戏落地为可运行的 MVP，并逐步完善到可玩可扩展。

## Stages 总览
- Stage 0：需求定稿与脚手架
- Stage 1：核心引擎 MVP
- Stage 2：后端 API + 存储
- Stage 3：Terminal 版本接入
- Stage 4：UI 版本接入
- Stage 5：RL Agent 框架
- Stage 6：完善与优化

---

## Stage 0：需求定稿与脚手架
**目标**：统一玩法细节、数据结构与目录结构，保证后续可并行开发。

- [ ] 明确游戏规则细节：
  - [ ] 回合/队列/ESC 行为细节
  - [ ] 射击命中判定与射程规则
  - [ ] 视野 5x5、听觉 7x7 的具体定义
  - [ ] 出口/入口逻辑与胜负条件
- [ ] 确认地图格式规范（50x50、S/E 语义）
- [ ] 确认数据库表与自动迁移策略
- [ ] 目录结构初始化（backend/engine、backend/api、backend/storage、frontend/terminal、frontend/UI）

**交付物**：玩法细则文档 + 目录结构空壳

---

## Stage 1：核心引擎 MVP
**目标**：完成纯内存的 game loop，单局可跑通。

- [ ] 世界状态结构（位置、HP、子弹、tick、队列、地图）
- [ ] 行为与判定：
  - [ ] MOVE/SHOOT/WAIT 行为定义
  - [ ] 子弹恢复与上限
  - [ ] 命中与死亡判定
  - [ ] 入口/出口判定
- [ ] 视野裁剪（5x5）与全局地图（50x50）加载
- [ ] tick 推进逻辑（1 秒 1 action）
- [ ] 观测数据结构（obs）

**交付物**：可在内存里跑通的一局游戏（含 tick 与 obs）

---

## Stage 2：后端 API + 存储
**目标**：支持 /game/new /game/action /game/tick /game/observe /game/resume /game/watch。

- [ ] FastAPI/Flask 选型与基础服务
- [ ] API 实现：
  - [ ] POST /game/new
  - [ ] POST /game/action
  - [ ] POST /game/tick
  - [ ] POST /game/clear_queue
  - [ ] POST /game/resume
  - [ ] GET /game/observe
  - [ ] GET /game/watch
- [ ] PostgreSQL 存储：
  - [ ] games_store（world state）
  - [ ] log_store（可选）
  - [ ] 自动迁移脚本
- [ ] 并发上限 50 局限制

**交付物**：可通过 API 创建/推进/恢复游戏

---

## Stage 3：Terminal 版本接入
**目标**：把游戏接到 patch/modules/terminal 的伪终端里。

- [ ] 确认 terminal 接入方式（Launcher or Window）
- [ ] 设计命令入口（例如：`catamaze` 启动）
- [ ] 游戏画面在终端渲染（ASCII UI）
- [ ] 输入队列与 ESC 清空队列行为
- [ ] 与后端 API 通讯

**交付物**：能在伪终端中运行一局游戏

---

## Stage 4：UI 版本接入
**目标**：静态 UI 版本渲染迷宫 5x5 视野。

- [ ] UI 组件布局（HP/Ammo/Time/Last sound/Memory/控制提示）
- [ ] 5x5 方格渲染（墙/路/玩家/agent）
- [ ] 资源图标接入（USER / aggressive / cautious / explorer）
- [ ] 与后端 API 通讯
- [ ] 键盘输入映射（WASD + IJKL）

**交付物**：可在 UI 页面玩一局游戏

---

## Stage 5：RL Agent 框架
**目标**：把 RL 接口打通（先规则/随机代理也可占位）。

- [ ] RL Agent 接口：engine -> RLAgent.act(obs)
- [ ] encoder / policy / reward / action_mask 框架
- [ ] persona 配置（aggressive/cautious/explorer）
- [ ] reward 计算与日志输出

**交付物**：三类 agent 能参与游戏并生成行为

---

## Stage 6：完善与优化
**目标**：可玩性与稳定性提升。

- [ ] 观战模式（-watch）
- [ ] 日志与调试工具
- [ ] 性能优化（50 并发）
- [ ] 错误处理与边界 case
- [ ] 试玩与调参（HP、Ammo、reward）

**交付物**：稳定可玩版本
